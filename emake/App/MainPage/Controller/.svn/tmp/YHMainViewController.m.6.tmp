//
//  YHMainViewController.m
//  emake
//
//  Created by 谷伟 on 2018/3/16.
//  Copyright © 2018年 emake. All rights reserved.
//

#import "YHMainViewController.h"
#import "SDCycleScrollView.h"
#import "YHMainPageCategoryCell.h"
#import "MainPageLastWeekCell.h"
#import "YHMainShoppingModel.h"
#import "YHProductClassifyViewController.h"
#import "YHMainMessageCenterViewController.h"
#import "ChatNewViewController.h"
#import "YHBrandQulificationViewController.h"
#import "YHInsuranceSeviceViewController.h"
#import "YHAfterServersViewController.h"
#import "YHLoginViewController.h"
#import "YHTodayPriceViewController.h"
#import "HRAdView.h"
#import "YHScanViewController.h"
#import "YHMainChooseCatagoryViewController.h"
#import "YHCommonWebViewController.h"
#import "YHDiscoverViewController.h"
#import "YHMainSearchViewController.h"
#import "YHNewAuditViewController.h"
#import "YHStoreCollectionViewCell.h"
#import "YHStoreViewController.h"
#import "YHStoreDetailViewController.h"
#import "StoreSeriesViewController.h"
#import "YHSendMessageToStoreListViewController.h"
@interface YHMainViewController ()<UICollectionViewDelegate,UICollectionViewDataSource,SDCycleScrollViewDelegate,YHAlertViewDelegete>{
    NSString *phone;
    HRAdView *adView;
}
@property (nonatomic,strong)NSMutableDictionary *dataArrayDic;

@property (nonatomic,strong)UIScrollView *CatagoryScrolView;
@property (nonatomic,strong)UILabel *labelTotal;
@property (nonatomic,strong)UITableView *lastWeekTableView;
@property (nonatomic,copy)NSString *all_Prices;
@property(nonatomic,strong)NSMutableArray *lastOrderArray;
@property(nonatomic,retain)NSArray *ScrolCategoryData;
@property(nonatomic,assign)NSString *isInstore;//1.店铺购买2.普通购买
@property(nonatomic,strong)UIView *categoryView;
@property(nonatomic,strong)UIView *viewLastWeek;
@property(nonatomic,strong)NSDictionary *category;
@property(nonatomic,strong)NSMutableArray *bannerImageGroup;
@property(nonatomic,strong)NSMutableArray *bannerInstuition;
@property(nonatomic,strong)NSMutableArray *commpanyServersArray;
@property(nonatomic,strong)SDCycleScrollView *cycleview;
@property(nonatomic,strong)UIButton *brandButton;
@property(nonatomic,strong)UIButton *qualityButton;
@property(nonatomic,strong)UIButton *afterSaleButton;
@property(nonatomic,strong)UIView *commpanyServersView;
@property(nonatomic,strong)UIScrollView *mainScrollView;
@property(nonatomic,strong)UICollectionView *storeCollectionView;
@property(nonatomic,strong)NSMutableArray *storeData;
@property(nonatomic,strong)UIButton *searchBtn;
@end

@implementation YHMainViewController
- (void)viewWillAppear:(BOOL)animated{
    [super viewWillAppear:animated];
    self.navigationItem.leftBarButtonItem = nil;
    phone = [[NSUserDefaults standardUserDefaults] objectForKey:LOGIN_MOBILEPHONE];
    [self.navigationController setNavigationBarHidden:YES animated:NO];
    NSInteger messageCount = 0;
    UIImageView *serverImage = (UIImageView *)[self.serverView viewWithTag:100];
    UIImageView *infomationImage = (UIImageView *)[self.infomationView viewWithTag:100];
    if (messageCount>0) {
        if (messageCount>99){
            messageCount = 99;
        }
        [serverImage showBadgeWithStyle:WBadgeStyleNumber value:messageCount animationType:WBadgeAnimTypeNone];
        serverImage.badgeCenterOffset = CGPointMake(WidthRate(-8), HeightRate(5));
    }else{
        [serverImage clearBadge];
    }
    NSInteger eventCount = 0;
    if (eventCount>0) {
        if (eventCount>99){
            eventCount = 99;
        }
        [infomationImage showBadgeWithStyle:WBadgeStyleNumber value:eventCount animationType:WBadgeAnimTypeNone];
        infomationImage.badgeCenterOffset = CGPointMake(WidthRate(-8), HeightRate(5));
        
    }else{
        [infomationImage clearBadge];
    }
    
    
        [self getMainPageAdd];
    [self getCateGoryData];
    [self getLastWeekData];
    [self getCommpanyServerData];
    [self getStoreData];
    [adView.timer setFireDate:[NSDate distantPast]];
}
- (void)viewWillDisappear:(BOOL)animated{
    [super viewWillDisappear:animated];
    [self.navigationController setNavigationBarHidden:YES animated:NO];
    [adView.timer setFireDate:[NSDate distantPast]];
}
- (void)viewDidLoad {
    
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    self.view.backgroundColor = TextColor_F5F5F5;
    self.isInstore = [[NSUserDefaults standardUserDefaults] objectForKey:LOGIN_ISSTORE];
    [self configSubViews];
    self.bannerImageGroup = [[NSMutableArray alloc]initWithCapacity:0];
    self.bannerInstuition = [[NSMutableArray alloc]initWithCapacity:0];
    
    phone = [[NSUserDefaults standardUserDefaults] objectForKey:LOGIN_MOBILEPHONE];
    if (phone.length <= 0) {
            YHMainChooseCatagoryViewController *choose = [[YHMainChooseCatagoryViewController alloc] init];
            choose.navigationController.navigationBarHidden = YES;
            choose.hidesBottomBarWhenPushed = YES;
            [self.navigationController pushViewController:choose animated:NO];
    }
    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(refreshMianView) name:NotificatonRefreshMainView object:nil];
}
- (void)refreshMianView{
    self.isInstore = [[NSUserDefaults standardUserDefaults] objectForKey:LOGIN_ISSTORE];
    UILabel *line = [self.mainScrollView viewWithTag:300];
    UIView *sepcialView = [self.mainScrollView viewWithTag:400];
    UILabel *lableLine = [self.mainScrollView viewWithTag:600];
    if ([self.isInstore isEqualToString:@"1"]) {
        self.mainScrollView.contentSize = CGSizeMake(0, HeightRate(755)-(TAB_BAR_HEIGHT));
        self.commpanyServersView.frame = CGRectMake(0, HeightRate(414), ScreenWidth, HeightRate(54));
        self.viewLastWeek.frame = CGRectMake(WidthRate(5), HeightRate(597), ScreenWidth-WidthRate(10), HeightRate(104));
        lableLine.frame = CGRectMake(0, HeightRate(468), ScreenWidth, HeightRate(2));
        self.serverView.hidden = true;
        self.searchBtn.hidden = true;
        line.hidden = true;
        sepcialView.hidden = true;
        self.storeCollectionView.hidden = false;
    }else{
        self.mainScrollView.contentSize = CGSizeMake(0, ScreenHeight-(TAB_BAR_HEIGHT));
        self.commpanyServersView.frame = CGRectMake(0, HeightRate(456), ScreenWidth, HeightRate(54));
        self.viewLastWeek.frame = CGRectMake(WidthRate(5), HeightRate(517), ScreenWidth-WidthRate(10), HeightRate(99));
        lableLine.frame = CGRectMake(0, HeightRate(510), ScreenWidth, HeightRate(2));
        self.serverView.hidden = false;
        self.searchBtn.hidden = false;
        line.hidden = false;
        sepcialView.hidden = false;
        self.storeCollectionView.hidden = true;
    }
}
- (UIView *)getPictureWithTextViewWithTag:(NSInteger)tag andText:(NSString *)text imageString:(NSString *)imageString{
    UIView *view = [[UIView alloc]initWithFrame:CGRectMake(0, 0, WidthRate(33), WidthRate(45))];
    UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
    [button addTarget:self action:@selector(goSelectVC:) forControlEvents:UIControlEventTouchUpInside];
    button.tag = tag;
    [view addSubview:button];
    
    [button mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(0);
        make.right.mas_equalTo(0);
        make.bottom.mas_equalTo(0);
        make.top.mas_equalTo(0);
    }];
    
    UIImageView *image = [[UIImageView alloc]initWithImage:[UIImage imageNamed:imageString]];
    image.contentMode = UIViewContentModeScaleAspectFit;
    image.tag = 100;
    [view addSubview:image];
    
    [image mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.mas_equalTo(WidthRate(0));
        make.centerX.mas_equalTo(view.mas_centerX);
        make.width.mas_equalTo(30);
        make.height.mas_equalTo(30);
    }];
    
    UILabel *label = [[UILabel alloc]init];
    label.text = text;
    label.font = SYSTEM_FONT(AdaptFont(9));
    [view addSubview:label];
    
    [label mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerX.mas_equalTo(view.mas_centerX);
        make.top.mas_equalTo(image.mas_bottom).offset(WidthRate(-4));
    }];
    return view;
}
- (void)configSubViews{
    
    self.mainScrollView = [[UIScrollView alloc] initWithFrame:CGRectMake(0, -(StatusBarHEIGHT), ScreenWidth, ScreenHeight-(TAB_BAR_HEIGHT)+(StatusBarHEIGHT))];
    self.mainScrollView.showsVerticalScrollIndicator = false;
    self.mainScrollView.alwaysBounceVertical = true;
    self.mainScrollView.alwaysBounceHorizontal = false;
    if ([self.isInstore isEqualToString:@"1"]) {
        self.mainScrollView.contentSize = CGSizeMake(0, HeightRate(755)-(TAB_BAR_HEIGHT));
    }else{
        self.mainScrollView.contentSize = CGSizeMake(0, ScreenHeight-(TAB_BAR_HEIGHT));
    }
    [self.view addSubview:self.mainScrollView];
    
    //banner
    self.cycleview = [SDCycleScrollView cycleScrollViewWithFrame:CGRectMake(0, 0, ScreenWidth, HeightRate(250)) delegate:self placeholderImage:[UIImage imageNamed:@""]];
    [self.mainScrollView addSubview:self.cycleview];

    
    //扫一扫
    self.categoryView = [self getPictureWithTextViewWithTag:1 andText:@"扫一扫" imageString:@"saomiao"];
    self.categoryView.frame = CGRectMake(WidthRate(9), (StatusBarHEIGHT)-3, WidthRate(35), HeightRateCommon(30));
    [self.mainScrollView addSubview:self.categoryView];


    //消息
    self.infomationView = [self getPictureWithTextViewWithTag:2 andText:@"消息" imageString:@"xiaoxi1"];
    self.infomationView.frame = CGRectMake(ScreenWidth-WidthRate(32), (StatusBarHEIGHT)-3, WidthRate(23), HeightRateCommon(30));
    [self.mainScrollView addSubview:self.infomationView];

    
    //客服
    self.serverView = [self getPictureWithTextViewWithTag:3 andText:@"客服" imageString:@"shouyekefu"];
    if ([self.isInstore isEqualToString:@"1"]) {
        self.serverView.hidden = true;
    }else{
        self.serverView.hidden = false;
    }
    self.serverView.frame = CGRectMake(ScreenWidth-WidthRate(73), (StatusBarHEIGHT)-3, WidthRate(23), HeightRateCommon(30));
    [self.mainScrollView addSubview:self.serverView];


    //搜索
    self.searchBtn = [[UIButton alloc] init];
    [self.searchBtn setTitleColor:ColorWithHexString(@"999999") forState:UIControlStateNormal];
    [self.searchBtn setBackgroundImage:[UIImage imageNamed:@"shouyesousuokuang"] forState:UIControlStateNormal];
    self.searchBtn.titleLabel.font = [UIFont systemFontOfSize:AdaptFont(12)];
    self.searchBtn.frame = CGRectMake(WidthRate(59), (StatusBarHEIGHT)+3, ScreenWidth-WidthRate(111), HeightRateCommon(30));
    [self.searchBtn setTitle:@"请输入搜索内容" forState:UIControlStateNormal];
    self.searchBtn.adjustsImageWhenHighlighted = NO;
    self.searchBtn.contentHorizontalAlignment = UIControlContentHorizontalAlignmentLeft ;
    self.searchBtn.titleEdgeInsets = UIEdgeInsetsMake(0, WidthRate(30), 0, 0);
    [self.searchBtn addTarget:self action:@selector(seachButtonClick) forControlEvents:UIControlEventTouchUpInside];
    [self.mainScrollView addSubview:self.searchBtn];
    if ([self.isInstore isEqualToString:@"1"]) {
        self.searchBtn.hidden = true;
    }else{
        self.searchBtn.hidden = false;
    }
    [self.searchBtn mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.mas_equalTo((StatusBarHEIGHT)+1);
        make.left.mas_equalTo(self.categoryView.mas_right).offset(WidthRate(15));
        make.right.mas_equalTo(self.serverView.mas_left).offset(WidthRate(-15));
        make.height.mas_equalTo(HeightRateCommon(30));
    }];

    
    //品类
    UIScrollView *CatagoryScrolView = [[UIScrollView alloc] init];
    CatagoryScrolView.pagingEnabled = YES;
    CatagoryScrolView.contentSize =  CGSizeMake(ScreenWidth, 165);
    CatagoryScrolView.frame = CGRectMake(0, HeightRate(250), ScreenWidth, HeightRate(165));
    [self.mainScrollView addSubview:CatagoryScrolView];
    self.CatagoryScrolView = CatagoryScrolView;


    //虚线
    UILabel *line333 = [[UILabel alloc] init];
    line333.tag = 300;
    line333.font = [UIFont systemFontOfSize:AdaptFont(14)];
    line333.frame = CGRectMake(0, HeightRate(414), ScreenWidth, HeightRate(2));
    line333.textColor = ColorWithHexString(@"cdd5e1");
    line333.text = @"-----------------------------------------------------------------------------------";
    if ([self.isInstore isEqualToString:@"1"]) {
        line333.hidden = true;
    }else{
        line333.hidden = false;
    }
    [self.mainScrollView addSubview:line333];

    //特殊询价
    UIView *sepacialView = [[UIView alloc]init];
    sepacialView.backgroundColor = ColorWithHexString(@"f0f0f0");
    sepacialView.tag = 400;
    sepacialView.frame = CGRectMake(0, HeightRate(416), ScreenWidth, HeightRate(40));
    [self.mainScrollView addSubview:sepacialView];
    if ([self.isInstore isEqualToString:@"1"]) {
        sepacialView.hidden = true;
    }else{
        sepacialView.hidden = false;
    }
    UITapGestureRecognizer *gesture = [[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(goSepacialPriceVC)];
    [sepacialView addGestureRecognizer:gesture];


    UIImageView *sepacialImage = [[UIImageView alloc]initWithImage:[UIImage imageNamed:@"teshupinxunjia"]];
    sepacialImage.contentMode = UIViewContentModeScaleAspectFit;
    [sepacialView addSubview:sepacialImage];

    [sepacialImage mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(WidthRate(30));
        make.centerY.mas_equalTo(sepacialView.mas_centerY);
        make.width.mas_equalTo(WidthRate(20));
        make.height.mas_equalTo(HeightRate(20));
    }];

    UILabel *textLabelSepcail = [[UILabel alloc]init];
    textLabelSepcail.text = @"个性化定制询价";
    textLabelSepcail.font = [UIFont boldSystemFontOfSize:AdaptFont(12)];
    [sepacialView addSubview:textLabelSepcail];
    [textLabelSepcail mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(sepacialImage.mas_right).offset(WidthRate(5));
        make.centerY.mas_equalTo(sepacialView.mas_centerY);
    }];

    UILabel *textLabelSepcailDe = [[UILabel alloc]init];
    textLabelSepcailDe.text = @"提供详细参数，实时报价";
    textLabelSepcailDe.textColor = TextColor_666666;
    textLabelSepcailDe.font = [UIFont systemFontOfSize:AdaptFont(11)];
    [sepacialView addSubview:textLabelSepcailDe];

    [textLabelSepcailDe mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(textLabelSepcail.mas_right).offset(WidthRate(3));
        make.centerY.mas_equalTo(sepacialView.mas_centerY);
    }];


    UIImageView *rightImage = [[UIImageView alloc]initWithImage:[UIImage imageNamed:@"teshupingengduo"]];
    rightImage.contentMode = UIViewContentModeScaleAspectFit;
    [sepacialView addSubview:rightImage];

    [rightImage mas_makeConstraints:^(MASConstraintMaker *make) {
        make.right.mas_equalTo(WidthRate(-30));
        make.centerY.mas_equalTo(sepacialView.mas_centerY);
        make.width.mas_equalTo(WidthRate(20));
        make.height.mas_equalTo(HeightRate(14));
    }];

    //企业服务
    self.commpanyServersView = [[UIView alloc]init];
    self.commpanyServersView.backgroundColor = ColorWithHexString(@"c3cedc");
    if ([self.isInstore isEqualToString:@"1"]) {
        self.commpanyServersView.frame = CGRectMake(0, HeightRate(414), ScreenWidth, HeightRate(54));
    }else{
        self.commpanyServersView.frame = CGRectMake(0, HeightRate(456), ScreenWidth, HeightRate(54));
    }
    [self.mainScrollView addSubview:self.commpanyServersView];
   

    UILabel *lableLine = [[UILabel alloc] init];
    lableLine.tag = 600;
    lableLine.backgroundColor = ColorWithHexString(@"617393");
    if ([self.isInstore isEqualToString:@"1"]) {
        lableLine.frame = CGRectMake(0, HeightRate(468), ScreenWidth, HeightRate(2));
    }else{
        lableLine.frame = CGRectMake(0, HeightRate(510), ScreenWidth, HeightRate(2));
    }
    [self.mainScrollView addSubview:lableLine];
    
    
    //店铺
    UICollectionViewFlowLayout *layout = [[UICollectionViewFlowLayout alloc] init];
    layout.headerReferenceSize = CGSizeMake(ScreenWidth, HeightRate(34));
    self.storeCollectionView = [[UICollectionView alloc] initWithFrame:CGRectMake(0, HeightRate(470), ScreenWidth, HeightRate(122)) collectionViewLayout:layout];
    self.storeCollectionView.translatesAutoresizingMaskIntoConstraints = NO;
    self.storeCollectionView.backgroundColor = TextColor_F7F7F7;
    self.storeCollectionView.scrollEnabled = NO;
    self.storeCollectionView.delegate = self;
    self.storeCollectionView.dataSource = self;
    if ([self.isInstore isEqualToString:@"1"]) {
        self.storeCollectionView.hidden = false;
    }else{
        self.storeCollectionView.hidden = true;
    }
    [self.mainScrollView addSubview:self.storeCollectionView];
    [self.storeCollectionView registerClass:[YHStoreCollectionViewCell class] forCellWithReuseIdentifier:@"StoreCell"];
    [self.storeCollectionView registerClass:[UICollectionReusableView class] forSupplementaryViewOfKind:UICollectionElementKindSectionHeader withReuseIdentifier:@"StoreHeader"];
    
    //上周订单
    self.viewLastWeek = [[UIView alloc]init];
    self.viewLastWeek.backgroundColor = [UIColor whiteColor];
    self.viewLastWeek.layer.cornerRadius = WidthRate(4);
    if ([self.isInstore isEqualToString:@"1"]) {
        self.viewLastWeek.frame = CGRectMake(WidthRate(5), HeightRate(597), ScreenWidth-WidthRate(10), HeightRate(104));
    }else{
        self.viewLastWeek.frame = CGRectMake(WidthRate(5), HeightRate(517), ScreenWidth-WidthRate(10), HeightRate(99));
    }
    [self.mainScrollView addSubview:self.viewLastWeek];


    UIImageView *orderImage = [[UIImageView alloc]initWithImage:[UIImage imageNamed:@"dingdanicon"]];
    orderImage.frame = CGRectMake(WidthRate(25), HeightRate(6.5), WidthRate(18), WidthRate(18));
    [self.viewLastWeek addSubview:orderImage];


    UILabel *labelTitle = [[UILabel alloc]init];
    labelTitle.text = @"上周订单";
    labelTitle.font = [UIFont systemFontOfSize:AdaptFont(13)];
    labelTitle.frame = CGRectMake(WidthRate(53), HeightRate(8.5), WidthRate(60), HeightRate(14));
    [self.viewLastWeek addSubview:labelTitle];

    
    self.labelTotal = [[UILabel alloc]init];
    self.labelTotal.font = [UIFont systemFontOfSize:AdaptFont(12)];
    self.labelTotal.textAlignment = NSTextAlignmentRight;
    self.labelTotal.textColor = [UIColor blackColor];
    self.labelTotal.frame = CGRectMake(0, HeightRate(8.5), ScreenWidth - WidthRate(20), HeightRate(14));
    [self.viewLastWeek addSubview:self.labelTotal];

    
    UILabel *line = [[UILabel alloc]init];
    line.backgroundColor = SepratorLineColor;
    [self.viewLastWeek addSubview:line];

    [line mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(WidthRate(20));
        make.height.mas_equalTo(1.5);
        make.right.mas_equalTo(WidthRate(-15));
        make.top.mas_equalTo(HeightRate(34));
    }];
    
}
- (void)configCommpanyServerView{
    for (UIView *view in self.commpanyServersView.subviews) {
        [view removeFromSuperview];
    }
    for (int i = 0; i<self.commpanyServersArray.count; i++) {
        YHCommpanyServersModel *model = self.commpanyServersArray[i];
        UIView *backView = [[UIView alloc]init];
        backView.backgroundColor = [UIColor whiteColor];
        backView.layer.borderWidth = WidthRate(1.5);
        backView.layer.borderColor = ColorWithHexString(@"617393").CGColor;
        backView.layer.cornerRadius = WidthRate(2);
        [self.commpanyServersView addSubview:backView];
        CGFloat width = (ScreenWidth-WidthRate(32))/3;
        [backView mas_makeConstraints:^(MASConstraintMaker *make) {
            make.width.mas_equalTo(width);
            make.left.mas_equalTo(WidthRate(8)*(i+1)+i*width);
            make.height.mas_equalTo(HeightRate(42));
            make.centerY.mas_equalTo(self.commpanyServersView.mas_centerY);
        }];
        
        UIButton *btn = [UIButton buttonWithType:UIButtonTypeCustom];
        btn.tag = model.ServiceType;
        [btn addTarget:self action:@selector(goCommmpanyServersVC:) forControlEvents:UIControlEventTouchUpInside];
        [backView addSubview:btn];
        
        [btn mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(0);
            make.top.mas_equalTo(0);
            make.right.mas_equalTo(0);
            make.bottom.mas_equalTo(0);
        }];
        
        UIImageView *imageIcon = [[UIImageView alloc]init];
        imageIcon.contentMode = UIViewContentModeScaleAspectFit;
        [imageIcon sd_setImageWithURL:[NSURL URLWithString:model.BrandServiceIcon]];
        [backView addSubview:imageIcon];
        
        [imageIcon mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(WidthRate(10));
            make.width.mas_equalTo(WidthRate(30));
            make.height.mas_equalTo(HeightRate(30));
            make.centerY.mas_equalTo(backView.mas_centerY);
        }];
        
        UILabel *title = [[UILabel alloc]init];
        title.text = model.BrandServiceTitle;
        title.font = SYSTEM_FONT(AdaptFont(13));
        [backView addSubview:title];

        [title mas_makeConstraints:^(MASConstraintMaker *make) {
            make.top.mas_equalTo(HeightRate(8));
            make.left.mas_equalTo(imageIcon.mas_right).offset(WidthRate(7));
        }];
        
        UILabel *titleDes = [[UILabel alloc]init];
        titleDes.text = model.BrandServiceDesc;
        titleDes.textColor = TextColor_666666;
        titleDes.font = SYSTEM_FONT(AdaptFont(9));
        [backView addSubview:titleDes];
        
        [titleDes mas_makeConstraints:^(MASConstraintMaker *make) {
            make.top.mas_equalTo(title.mas_bottom).offset(HeightRate(1));
            make.left.mas_equalTo(imageIcon.mas_right).offset(WidthRate(7));
        }];
        
    }
    if (self.commpanyServersArray.count == 1) {
        UIView *backView = [[UIView alloc]init];
        backView.backgroundColor = [UIColor whiteColor];
        backView.layer.borderWidth = WidthRate(1.5);
        backView.layer.borderColor = SepratorLineColor.CGColor;
        backView.layer.cornerRadius = WidthRate(2);
        [self.commpanyServersView addSubview:backView];
        [backView mas_makeConstraints:^(MASConstraintMaker *make) {
            make.right.mas_equalTo(WidthRate(-0));
            make.left.mas_equalTo(0);
            make.height.mas_equalTo(HeightRate(42));
            make.centerY.mas_equalTo(self.commpanyServersView.mas_centerY);
        }];
        
        UIButton *btn = [UIButton buttonWithType:UIButtonTypeCustom];
        [btn addTarget:self action:@selector(goTodayPriceVC) forControlEvents:UIControlEventTouchUpInside];
        [backView addSubview:btn];
        
        [btn mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(0);
            make.top.mas_equalTo(0);
            make.right.mas_equalTo(0);
            make.bottom.mas_equalTo(0);
        }];
        
        UIImageView *imageIcon = [[UIImageView alloc]initWithImage:[UIImage imageNamed:@"dangrishoujia02"]];
        imageIcon.contentMode = UIViewContentModeScaleAspectFit;
        [backView addSubview:imageIcon];
        
        [imageIcon mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(WidthRate(10));
            make.width.mas_equalTo(WidthRate(30));
            make.height.mas_equalTo(HeightRate(30));
            make.centerY.mas_equalTo(backView.mas_centerY);
        }];
        
        UILabel *title = [[UILabel alloc]init];
        title.text = @"提供最新报价";
        title.font = SYSTEM_FONT(AdaptFont(13));
        [backView addSubview:title];
        
        [title mas_makeConstraints:^(MASConstraintMaker *make) {
            make.top.mas_equalTo(HeightRate(8));
            make.left.mas_equalTo(imageIcon.mas_right).offset(WidthRate(7));
        }];
        
        UILabel *titleDes = [[UILabel alloc]init];
        titleDes.text = @"相关产品最新报价";;
        titleDes.textColor = TextColor_666666;
        titleDes.font = SYSTEM_FONT(AdaptFont(9));
        [backView addSubview:titleDes];
        
        [titleDes mas_makeConstraints:^(MASConstraintMaker *make) {
            make.top.mas_equalTo(title.mas_bottom).offset(HeightRate(1));
            make.left.mas_equalTo(imageIcon.mas_right).offset(WidthRate(7));
        }];
    }
}
- (void)configLastWeekScroll{
    
    NSMutableArray *array = [NSMutableArray arrayWithCapacity:0];
    [array addObject:self.lastOrderArray[0]];
    [array addObject:self.lastOrderArray[1]];
    [array addObject:self.lastOrderArray[2]];
    [adView removeFromSuperview];
    adView = [[HRAdView alloc]initWithTitles:self.lastOrderArray];
    adView.frame = CGRectMake(0, HeightRate(36), ScreenWidth-WidthRate(15), HeightRate(72));
    adView.time = 2.0f;
    [self.viewLastWeek addSubview:adView];
    if (array.count >1) {
        [adView beginScroll];
    }
    
}
//搜索
-(void)seachButtonClick{

    YHMainSearchViewController *search = [[YHMainSearchViewController alloc] init];
    search.hidesBottomBarWhenPushed =  YES;
    [self.navigationController pushViewController:search animated:YES];
}
- (void)goSelectVC:(UIButton *)sender{
    bool isVisist = [self isVisitorLoginByPhoneNumberExits];
    if (isVisist ==false) {
        return;
    }
    switch (sender.tag) {
        case 1:{
            YHScanViewController *scan = [[YHScanViewController alloc] init];
            scan.hidesBottomBarWhenPushed = YES;
            [self.navigationController pushViewController:scan animated:YES];
        }
            break;
        case 2:{
            YHMainMessageCenterViewController *vc = [[YHMainMessageCenterViewController alloc]init];
            vc.hidesBottomBarWhenPushed = YES;
            [self.navigationController pushViewController:vc animated:YES];
        }
            break;
        case 3:{
            
        }
            break;
        default:
            break;
    }
}
- (void)goCommmpanyServersVC:(UIButton *)btn{
    switch (btn.tag) {
        case 1:{
           
         
            YHBrandQulificationViewController *vc = [[YHBrandQulificationViewController alloc]init];
            vc.hidesBottomBarWhenPushed = YES;
            [self.navigationController pushViewController:vc animated:YES];
        }
            break;
        case 2:{

            YHInsuranceSeviceViewController *vc = [[YHInsuranceSeviceViewController alloc]init];
            vc.hidesBottomBarWhenPushed = YES;
            [self.navigationController pushViewController:vc animated:YES];
        }
            break;
        case 3:{
    
            YHAfterServersViewController *vc = [[YHAfterServersViewController alloc]init];
            vc.hidesBottomBarWhenPushed = YES;
            [self.navigationController pushViewController:vc animated:YES];
        }
            break;
        case 4:{//订购流程

            YHCommonWebViewController *vc = [[YHCommonWebViewController alloc]init];

            vc.hidesBottomBarWhenPushed = YES;
            vc.titleName = @"订购流程";
            vc.time = WebTypeUserInstructions;
            vc.URLString = UserOrderingproURL;
            [self.navigationController pushViewController:vc animated:YES];
        }
            break;
        case 5:{//订购须知
            
            YHCommonWebViewController *vc = [[YHCommonWebViewController alloc]init];
            vc.hidesBottomBarWhenPushed = YES;
            vc.titleName = @"订购须知";
            vc.time = WebTypeUserInstructions;
            vc.URLString =UserOrderinginfoURL ;
            [self.navigationController pushViewController:vc animated:YES];
        }
            break;
        default:
            break;
    }
}
- (void)getLastWeekData{
    
    [[YHJsonRequest shared] getuserLastweekOrder:^(NSDictionary *shoppingCartDict) {
        self.all_Prices = [shoppingCartDict objectForKey:@"all_price"];
        NSString *allPrice = [Tools getNsstringFromDouble:self.all_Prices.doubleValue isShowUNIT:NO];
        NSString *str = [NSString stringWithFormat:@"总额  ¥%@",allPrice];
        NSMutableAttributedString *AttributedStr = [[NSMutableAttributedString alloc]initWithString:str];
        [AttributedStr addAttribute:NSForegroundColorAttributeName value:ColorWithHexString(APP_THEME_MAIN_COLOR) range:NSMakeRange(3,str.length-3)];
        [AttributedStr addAttribute:NSFontAttributeName value:SYSTEM_FONT(AdaptFont(14)) range:NSMakeRange(3,str.length-3)];
        self.labelTotal.attributedText = AttributedStr;
        if ([shoppingCartDict objectForKey:@"party_list"]) {
            NSArray *arr =  [shoppingCartDict objectForKey:@"party_list"];
            self.lastOrderArray = [NSMutableArray arrayWithArray:arr];
            if (self.lastOrderArray.count >0) {
                [self configLastWeekScroll];
            }else{
                [adView removeFromSuperview];
            }
            [self.view hideWait:CurrentView];
        }
    } fialureBlock:^(NSString *errorMessages) {
        [self.view hideWait:CurrentView];
        [self.view makeToast:errorMessages duration:1.0 position:CSToastPositionCenter];
        
    }];
}
- (void)getMainPageAdd{
    
    [[YHJsonRequest shared] getMainPageAddSuccessBlock:^(NSArray *mianImageAddArray) {
        [self.bannerImageGroup removeAllObjects];
        [self.bannerInstuition removeAllObjects];
        for (NSDictionary *dict in mianImageAddArray) {
            if (![dict objectForKey:@"ADUrl"]) {
                return;
            }
            [self.bannerImageGroup addObject:[dict objectForKey:@"ADUrl"]];
            [self.bannerInstuition addObject:[dict objectForKey:@"ADSkipLinkIos"]];
        }
        self.cycleview.imageURLStringsGroup = self.bannerImageGroup;
        if (self.bannerImageGroup.count>1) {
            self.cycleview.autoScroll = YES;
        }
    } fialureBlock:^(NSString *errorMessages) {
        [self.view makeToast:errorMessages duration:1.0 position:CSToastPositionCenter];
    }];
}
- (void)getCateGoryData{
    
 
    [[self.CatagoryScrolView  subviews] enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        if([obj isKindOfClass:[UICollectionView class]])
        {
            [obj removeFromSuperview];
        }
    }];
    self.dataArrayDic = [NSMutableDictionary dictionary];
    self.category = [NSMutableDictionary dictionary];
    [[YHJsonRequest shared] getMainPageCategorySuccessBlock:^(NSArray *categoryDict) {
        self.ScrolCategoryData = [NSArray arrayWithArray:categoryDict];
        if (categoryDict.count>0) {
            
            [self ConfigCatagoryCollectionView:[NSArray arrayWithObject:categoryDict.firstObject]];
        }
    } fialureBlock:^(NSString *errorMessages) {
        [self.view makeToast:errorMessages duration:1.0 position:CSToastPositionCenter];
    }];
}
- (void)getCommpanyServerData{
    
    self.commpanyServersArray = [NSMutableArray arrayWithCapacity:0];
    [[YHJsonRequest shared] getBusinessServiceSuccessBlock:^(NSArray *listArray){
        self.commpanyServersArray = [NSMutableArray arrayWithArray:listArray];
        [self configCommpanyServerView];
    } fialureBlock:^(NSString *errorMessages) {
        [self.view makeToast:errorMessages duration:1.0 position:CSToastPositionCenter];
    }];
}

- (void)getStoreData{
    self.storeData = [NSMutableArray arrayWithCapacity:0];
    [[YHJsonRequest shared] getFindStoreListSuccessBlock:^(NSArray *Success) {
        self.storeData = [NSMutableArray arrayWithArray:Success];
        [self.storeCollectionView reloadData];
    } fialureBlock:^(NSString *errorMessages) {
        [self.view makeToast:errorMessages duration:1.0 position:CSToastPositionCenter];
    }];
}

- (void)goTodayPriceVC{
    
    if (phone.length<=0) {
        YHLoginViewController *loginViewController = [[YHLoginViewController alloc] init];
        loginViewController.navigationController.navigationBarHidden = YES;
        loginViewController.hidesBottomBarWhenPushed =YES;
        [self.navigationController pushViewController:loginViewController animated:YES];
        return;
    }
    self.tabBarController.selectedIndex = 1;
}

- (void)goSepacialPriceVC{

    bool isVisist = [self isVisitorLoginByPhoneNumberExits];
    if (isVisist ==false) {
        return;
    }
    UIStoryboard *storyboard = [UIStoryboard storyboardWithName:@"Chat" bundle:nil];
    ChatNewViewController *vc = [storyboard instantiateViewControllerWithIdentifier:@"Chat"];
    NSString *userID = [[NSUserDefaults standardUserDefaults] objectForKey:LOGIN_USERID];
    vc.listID = userID;
    vc.hidesBottomBarWhenPushed = YES;
    [self.navigationController pushViewController:vc animated:YES];
}

//发现
- (void)goDiscoverNewsVC{
    
    YHDiscoverViewController *discover = [[YHDiscoverViewController alloc] init];
    discover.hidesBottomBarWhenPushed = YES;
    [self.navigationController pushViewController:discover animated:YES];
}
- (void)goStoreVC{
    [MobClick event:@"dianpugengduo" label:@"店铺更多"];

    YHStoreViewController *vc = [[YHStoreViewController alloc] init];\
    vc.hidesBottomBarWhenPushed = YES;
    [self.navigationController pushViewController:vc animated:YES];
}
#pragma mark---UICollectionViewDelegate & UICollectionViewDataSource
- (NSInteger)collectionView:(UICollectionView *)collectionView numberOfItemsInSection:(NSInteger)section{
    if ([collectionView isEqual:self.storeCollectionView]) {
        if (self.storeData.count >=4) {
            return 4;
        }
        return self.storeData.count;
    }else{
        NSInteger keyNum = collectionView.tag-10000;
        NSLog(@"keynum==%ld",keyNum);
        NSArray *dataArr = self.dataArrayDic[@(keyNum)];
        if (dataArr.count > 9) {
            return 10;
        }
        return dataArr.count;
    }
}
- (UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath{
    if ([collectionView isEqual:self.storeCollectionView]) {
        YHStoreCollectionViewCell *cell =(YHStoreCollectionViewCell *)[collectionView dequeueReusableCellWithReuseIdentifier:@"StoreCell" forIndexPath:indexPath];
        if (!cell) {
            cell = [[YHStoreCollectionViewCell alloc]initWithFrame:CGRectMake(0, 0, ScreenWidth/4,  HeightRate(88))];
        }
        cell.backgroundColor = [UIColor whiteColor];
        YHStoreModel *model = [self.storeData objectAtIndex:indexPath.item];
        [cell setData:model];
        return cell;
    }else{
        YHMainPageCategoryCell *cell =(YHMainPageCategoryCell *)[collectionView dequeueReusableCellWithReuseIdentifier:@"MainPageCategoryCell" forIndexPath:indexPath];
        if (!cell) {
            cell = [[YHMainPageCategoryCell alloc]initWithFrame:CGRectMake(0, 0, WidthRate(47),  HeightRate(60))];
        }
        NSInteger keyNum = collectionView.tag-10000;
        NSArray *dataArr = self.dataArrayDic[@(keyNum)];
        NSDictionary *dict =indexPath.row<9? dataArr[indexPath.row]:dataArr.lastObject;
        [cell setData:dict isLastObjict:indexPath.row<9?(indexPath.row==dataArr.count-1?YES:false):YES];
        return cell;
    }
}
- (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout sizeForItemAtIndexPath:(NSIndexPath *)indexPath{
    if ([collectionView isEqual:self.storeCollectionView]) {
        return CGSizeMake(ScreenWidth/4, HeightRate(88));
    }else{
        return CGSizeMake(WidthRate(47), HeightRate(60));
    }
}
- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout minimumInteritemSpacingForSectionAtIndex:(NSInteger)section{
    if ([collectionView isEqual:self.storeCollectionView]) {
        return 0;
    }else{
        return WidthRate(15);
    }
}
- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout minimumLineSpacingForSectionAtIndex:(NSInteger)section{
    if ([collectionView isEqual:self.storeCollectionView]) {
        return 0;
    }else{
        return HeightRateCommon(25);
    }
}
- (UIEdgeInsets)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout insetForSectionAtIndex:(NSInteger)section{
    if ([collectionView isEqual:self.storeCollectionView]) {
        return UIEdgeInsetsMake(0, 0, 0, 0);
    }else{
        return UIEdgeInsetsMake(HeightRate(10), WidthRate(10), HeightRate(0), WidthRate(20));
    }
}
- (void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath{
    if ([collectionView isEqual:self.storeCollectionView]) {
        [MobClick event:@"dianpu" label:@"店铺"];

        YHStoreModel *model = self.storeData[indexPath.item];
        YHStoreDetailViewController *vc = [[YHStoreDetailViewController alloc] init];
        vc.hidesBottomBarWhenPushed = YES;
        vc.storeId = model.StoreId;
        vc.storeName = model.StoreName;

        [self.navigationController pushViewController:vc animated:YES];
    }else{
        [MobClick event:@"quanbushangping" label:@"全部商品"];

        BOOL isIndustry = [[NSUserDefaults standardUserDefaults] boolForKey:IsIndustryCatagory];
        NSInteger keyNum = collectionView.tag-10000;
        NSArray *dataArr = self.dataArrayDic[@(keyNum)];
        NSDictionary *dict =indexPath.row<10? dataArr[indexPath.row]:dataArr.lastObject;
        if ([self.isInstore isEqualToString:@"1"]) {
            
            StoreSeriesViewController *vc = [[StoreSeriesViewController alloc]init];
            vc.hidesBottomBarWhenPushed = YES;
            vc.CategoryId = dataArr.lastObject[@"CategoryId"];
            vc.goodsName = dict[@"CategoryName"];
            [self.navigationController pushViewController:vc animated:YES];

        }else
        {
        YHProductClassifyViewController *vc = [[YHProductClassifyViewController alloc]init];
        vc.hidesBottomBarWhenPushed = YES;
        if (indexPath.row < 10 && indexPath.row < dataArr.count-1) {
            vc.serriesCode = dict[@"CategoryId"];
            vc.titleName = dict[@"CategoryName"];
            vc.CategoryId = dataArr.lastObject[@"CategoryId"];
        }else{
            [MobClick event:@"CloudFactory" label:@"云工厂"];
        }
        [self.navigationController pushViewController:vc animated:YES];
        }
    }
}
- (UICollectionReusableView *)collectionView:(UICollectionView *)collectionView viewForSupplementaryElementOfKind:(NSString *)kind atIndexPath:(NSIndexPath *)indexPath{
    UICollectionReusableView *ReusableView = [collectionView dequeueReusableSupplementaryViewOfKind:UICollectionElementKindSectionHeader withReuseIdentifier:@"StoreHeader" forIndexPath:indexPath];
    UILabel *lable = [[UILabel alloc] initWithFrame:CGRectMake(WidthRate(20), HeightRate(9.5), WidthRate(80), HeightRate(15))];
    lable.textColor = TextColor_333333;
    lable.font = [UIFont systemFontOfSize:AdaptFont(13)];
    lable.text = @" 发现店铺";
    [ReusableView addSubview:lable];
    
    UILabel *lableMore = [[UILabel alloc] initWithFrame:CGRectMake(ScreenWidth - WidthRate(75), HeightRate(9.5), WidthRate(60), HeightRate(15))];
    lableMore.textAlignment = NSTextAlignmentRight;
    lableMore.textColor = ColorWithHexString(@"9B9B9B");
    lableMore.font = [UIFont systemFontOfSize:AdaptFont(12)];
    lableMore.text = @"更多";
    [ReusableView addSubview:lableMore];
    
    UIButton *buttonMore = [UIButton buttonWithType:UIButtonTypeCustom];
    buttonMore.frame = CGRectMake(0, 0, ScreenWidth,HeightRate(34));
    [buttonMore addTarget:self action:@selector(goStoreVC) forControlEvents:UIControlEventTouchUpInside];
    [ReusableView addSubview:buttonMore];

    return ReusableView;
}

#pragma makk ---- YHAlertViewDelegate
- (void)alertViewRightBtnClick:(id)alertView{
    YHNewAuditViewController *vc = [[YHNewAuditViewController alloc] init];
    vc.isfail = YES;
    vc.hidesBottomBarWhenPushed = YES;
    [self.navigationController pushViewController:vc animated:YES];
}

#pragma  mark -----SDCycleScrollViewDelegate
- (void)cycleScrollView:(SDCycleScrollView *)cycleScrollView didSelectItemAtIndex:(NSInteger)index{
    if (self.bannerInstuition.count<=0) {
        return;
    }
//    [MobClick event:@"ShufflingFigure" label:@"轮播图"];
    if (index==0) {
        [MobClick event:@"Xiazai" label:@"我要开店"];

    }
    NSString *JsonString = [self.bannerInstuition objectAtIndex:index];
    NSData *jsonData = [JsonString dataUsingEncoding:NSUTF8StringEncoding];
    NSError *err;
    NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:jsonData
                                                    options:NSJSONReadingMutableContainers
                                                           error:&err];
    if ([dict[@"className"] isEqualToString:@"YHTodayPriceViewController"]){
        self.tabBarController.selectedIndex = 1;
        return;
    }
    Class class = NSClassFromString(dict[@"className"]);
    UIViewController *vc = [[class alloc] init];
    // 获取参数列表，使用枚举的方式，对控制器属性进行KVC赋值
    NSDictionary *parameter = dict[@"propertys"];
    [parameter enumerateKeysAndObjectsUsingBlock:^(id  _Nonnull key, id  _Nonnull obj, BOOL * _Nonnull stop) {
        // 在属性赋值时，做容错处理，防止因为后台数据导致的异常
        if ([vc respondsToSelector:NSSelectorFromString(key)]) {
            [vc setValue:obj forKey:key];
        }
    }];
    vc.hidesBottomBarWhenPushed = YES;
    [self.navigationController pushViewController:vc animated:YES];
    // 从字典中获取方法名，并调用对应的方法
    if (dict[@"method"]) {
        SEL selector = NSSelectorFromString(dict[@"method"]);
        [vc performSelector:selector];
    }
}
-(void)specilView:(UIView *)specilView tiltle:(NSString *)title othertiltle:(NSString *)othertiltle imageName:(NSString *)imageName isRight:(BOOL)isRight{
    UIView *sepacialBgView = [[UIView alloc]init];
    sepacialBgView.backgroundColor = [UIColor whiteColor];
    sepacialBgView.layer.cornerRadius = HeightRate(17);
    sepacialBgView.layer.masksToBounds = YES;
    if (isRight==NO) {
         UITapGestureRecognizer *gesture = [[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(goSepacialPriceVC)];
        [sepacialBgView addGestureRecognizer:gesture];
    }else{
        UITapGestureRecognizer *gesture = [[UITapGestureRecognizer alloc]initWithTarget:self action:@selector(goDiscoverNewsVC)];
        [sepacialBgView addGestureRecognizer:gesture];
    }
    [self.view addSubview:sepacialBgView];
    [sepacialBgView mas_makeConstraints:^(MASConstraintMaker *make) {
        if (isRight==YES) {
            make.right.mas_equalTo(-10);
        }else{
            make.left.mas_equalTo(10);
        }
        make.width.mas_equalTo(WidthRate(175));
        make.centerY.mas_equalTo(specilView.mas_centerY);
        make.height.mas_equalTo(HeightRate(34));
    }];
    
    UIImageView *sepacialImage = [[UIImageView alloc]initWithImage:[UIImage imageNamed:imageName]];
    sepacialImage.contentMode = UIViewContentModeScaleAspectFit;
    [sepacialBgView addSubview:sepacialImage];
    
    [sepacialImage mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(WidthRate(20));
        make.centerY.mas_equalTo(specilView.mas_centerY);
        make.width.mas_equalTo(WidthRate(20));
        make.height.mas_equalTo(HeightRate(20));
    }];
    
    
    UILabel *textLabelSepcail = [[UILabel alloc]init];
    textLabelSepcail.text = title;
    textLabelSepcail.font = [UIFont boldSystemFontOfSize:AdaptFont(12)];
    [sepacialBgView addSubview:textLabelSepcail];
    
    [textLabelSepcail mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(sepacialImage.mas_right).offset(WidthRate(5));
        make.centerY.mas_equalTo(specilView.mas_centerY);
    }];
    
    UILabel *textLabelSepcailDe = [[UILabel alloc]init];
    textLabelSepcailDe.text = othertiltle;
    textLabelSepcailDe.textColor = TextColor_666666;
    textLabelSepcailDe.font = [UIFont systemFontOfSize:AdaptFont(11)];
    [sepacialBgView addSubview:textLabelSepcailDe];
    
    [textLabelSepcailDe mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.mas_equalTo(textLabelSepcail.mas_right).offset(WidthRate(3));
        make.centerY.mas_equalTo(specilView.mas_centerY);
    }];
}


-(void)ConfigCatagoryCollectionView:(NSArray *)CatagoryArray{
    
    self.CatagoryScrolView.contentSize = CGSizeMake(ScreenWidth*CatagoryArray.count, 0);
    self.CatagoryScrolView.pagingEnabled = YES;
    self.CatagoryScrolView.delegate = self;

    for ( int i=0;i<CatagoryArray.count;i++ ) {
        NSDictionary *dict =CatagoryArray[i];
        NSMutableArray * dataArray = [NSMutableArray arrayWithArray:dict[@"CategoryList"]];
        NSDictionary *lastData = @{@"CategoryId":dict[@"CategoryId"],@"CategoryName":dict[@"CategoryName"],@"CategoryIcon":dict[@"FactoryIcon"]};
        [dataArray addObject:lastData];
        UICollectionViewFlowLayout *layout = [[UICollectionViewFlowLayout alloc] init];
        UICollectionView * CatogoryCollectionView = [[UICollectionView alloc] initWithFrame:CGRectZero collectionViewLayout:layout];
        CatogoryCollectionView.translatesAutoresizingMaskIntoConstraints = NO;
        CatogoryCollectionView.backgroundColor = [UIColor whiteColor];
        CatogoryCollectionView.scrollEnabled = NO;
        CatogoryCollectionView.delegate = self;
        CatogoryCollectionView.dataSource = self;
        CatogoryCollectionView.tag = 10000+i;
        [self.CatagoryScrolView addSubview:CatogoryCollectionView];
        [CatogoryCollectionView registerClass:[YHMainPageCategoryCell class] forCellWithReuseIdentifier:@"MainPageCategoryCell"];
        [CatogoryCollectionView registerClass:[UICollectionViewCell class] forCellWithReuseIdentifier:@"LsatCategoryCell"];
        [CatogoryCollectionView registerClass:[UICollectionReusableView class] forSupplementaryViewOfKind:UICollectionElementKindSectionHeader withReuseIdentifier:@"header"];
        CatogoryCollectionView.alwaysBounceHorizontal = YES;
        CatogoryCollectionView.showsHorizontalScrollIndicator = NO;
        [CatogoryCollectionView mas_makeConstraints:^(MASConstraintMaker *make) {
            make.left.mas_equalTo(0);
            make.width.mas_equalTo(ScreenWidth*(i+1));
            make.top.mas_equalTo(0);
            make.height.mas_equalTo(HeightRate(165));
        }];
        [CatogoryCollectionView reloadData];
        [self.dataArrayDic setObject:dataArray forKey:@(i)];
    }
}

-(void)scrollViewDidEndDecelerating:(UIScrollView *)scrollView
{
//    for (int i= 0; i  <self.ScrolCategoryData.count; i++) {
    int num =(int) scrollView.contentOffset.x/ScreenWidth;
        UICollectionView *collView = [self.CatagoryScrolView viewWithTag:10000+num];
        [collView reloadData];
//    }
}
- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}
/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
